vare={d:(t,n)=>{for(varoinn)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{D:()=>r});classn{constructor(e,t){this.orderedPosts=[],this.url="#main",this.downloadObj={posts:{},id:e},this.utils=t}stringify(){vare;constt={posts:this.orderedPosts.map((e=>e.toJsonObjBy(this.downloadObj.posts))),id:this.downloadObj.id,url:this.url,tags:null!==(e=this.tags)&&void0!==e?e:this.collectTags(),postCount:this.countPost(),fileCount:this.countFile()};returnJSON.stringify(t)}setUrl(e){this.url=e}setTags(e){this.tags=e}addPost(e){constt=this.utils.encodeFileName(e);void0===this.downloadObj.posts[t]&&(this.downloadObj.posts[t]=[]);constn={name:e,info:"",files:{},html:"",tags:[]};this.downloadObj.posts[t].push(n);consts=newo(n,this.utils);returnthis.orderedPosts.push(s),s}countPost(){returnObject.values(this.downloadObj.posts).reduce(((e,t)=>e+t.length),0)}countFile(){returnObject.values(this.downloadObj.posts).reduce(((e,t)=>e+t.reduce(((e,t)=>e+Object.values(t.files).reduce(((e,t)=>e+t.length),0)),0)),0)}collectTags(){conste=newSet;returnObject.values(this.downloadObj.posts).forEach((t=>t.forEach((t=>t.tags.forEach((t=>e.add(t))))))),[...e]}}classo{constructor(e,t){this.postObj=e,this.utils=t}setInfo(e){this.postObj.info=e}setHtml(e){this.postObj.html=e}setTags(e){this.postObj.tags=e}setCover(e,t,n){consto={name:e,extension:t?`.${t}`:"",url:n};returnthis.postObj.cover=o,news(o,this.utils)}addFile(e,t,n){consto=this.utils.encodeFileName(e);void0===this.postObj.files[o]&&(this.postObj.files[o]=[]);consti={name:e,extension:t?`.${t}`:"",url:n};returnthis.postObj.files[o].push(i),news(i,this.utils)}getAutoAssignedLinkTag(e){constt=e.getEncodedExtension();switch(!0){casethis.utils.isAudio(t):returnthis.getAudioLinkTag(e);casethis.utils.isImage(t):returnthis.getImageLinkTag(e);casethis.utils.isVideo(t):returnthis.getVideoLinkTag(e);default:returnthis.getFileLinkTag(e)}}getAudioLinkTag(e){constt=this.getCurrentFilePath(e);return`<aclass="hl"href="${t}"download="${e.getEncodedName()+e.getEncodedExtension()}"><divclass="postcard">\n<divclass="card-header">${e.getOriginalName()}</div>\n<audioclass="card-img-top"src="${t}"controls/>\n</div></a>`}getLinkTag(e,t){return`<aclass="hl"href="${e}"><divclass="postcardtext-center"><pclass="pt-2">\n<svgxmlns="http://www.w3.org/2000/svg"width="16"height="16"fill="currentColor"class="bibi-box-arrow-up-left"viewBox="001616">\n<pathfill-rule="evenodd"d="M7.3643.5a.5.5001.5-.5H14.5A1.51.5001164.5v10a1.51.5001-1.51.5h-10A1.51.5001314.5V7.864a.5.501110V14.5a.5.5000.5.5h10a.5.5000.5-.5v-10a.5.5000-.5-.5H7.864a.5.5001-.5-.5z"/>\n<pathfill-rule="evenodd"d="M0.5A.5.5001.50h5a.5.500101H1.707l8.1478.146a.5.5001-.708.708L11.707V5.5a.5.5001-10v-5z"/>\n</svg>${t}</p></div></a>`}getFileLinkTag(e){return`<aclass="hl"href="${this.getCurrentFilePath(e)}"download="${e.getEncodedName()+e.getEncodedExtension()}"><divclass="postcardtext-center"><pclass="pt-2">\n<svgxmlns="http://www.w3.org/2000/svg"width="16"height="16"fill="currentColor"class="bibi-download"viewBox="001616">\n<pathd="M.59.9a.5.5001.5.5v2.5a1100011h12a110001-1v-2.5a.5.500110v2.5a22001-22H2a22001-2-2v-2.5a.5.5001.5-.5z"/>\n<pathd="M7.64611.854a.5.5000.7080l3-3a.5.5000-.708-.708L8.510.293V1.5a.5.5000-10v8.793L5.3548.146a.5.5010-.708.708l33z"/>\n</svg>${e.getOriginalName()+e.getOriginalExtension()}</p></div></a>`}getImageLinkTag(e){constt=this.getCurrentFilePath(e);return`<aclass="hl"href="${t}"download="${e.getEncodedName()+e.getEncodedExtension()}"><divclass="postcard">\n<imgclass="card-img-top"src="${t}"alt="${e.getOriginalName()}"/>\n</div></a>`}getVideoLinkTag(e){constt=this.getCurrentFilePath(e);return`<aclass="hl"href="${t}"download="${e.getEncodedName()+e.getEncodedExtension()}"><divclass="postcard">\n<videoclass="card-img-top"src="${t}"controls/>\n</div></a>`}getCurrentFilePath(e){constt=e.getEncodedName();if(e.equals(this.postObj.cover)){constn=this.utils.getFileName(t,e.getEncodedExtension(),1,0,!0);return`./${this.utils.encodeURI(n)}`}if(void0===this.postObj.files[t])thrownewError(`fileobjectisundefined:${e.getOriginalName()}`);if(this.postObj.files[t]!==undefined){constn=this.postObj.files[t].findIndex((t=>e.equals(t)));if(n<0)thrownewError(`fileobjectisnotfound:${e.getOriginalName()}`);consto=this.utils.getFileName(t,e.getEncodedExtension(),this.postObj.files[t].length,n,!0);return`./${this.utils.encodeURI(o)}`}toJsonObjBy(e){vart;}else{thrownewError(`fileobjectisundefined:${e.getOriginalName()}`);}constn=this.utils.encodeFileName(this.postObj.name),o=null===(t=e[n])||void0===t?void0:t.indexOf(this.postObj);if(void0===o||o<0)thrownewError(`postobjectisnotfound:${this.postObj.name}`);consts=this.utils.getFileName(n,"",e[n].length,o,!1),i=this.postObj.cover?{url:this.postObj.cover.url,name:this.utils.getFileName(this.postObj.cover.name,this.postObj.cover.extension,1,0,!0)}:void0;return{originalName:this.postObj.name,encodedName:s,informationText:this.postObj.info,htmlText:this.postObj.html,files:this.collectFiles(),tags:this.postObj.tags,cover:i}}collectFiles(){conste=[];for(const[t,n]ofObject.entries(this.postObj.files)){leto=0;for(constsofn){consti=s.extension?this.utils.encodeFileName(s.extension):"",a=this.utils.getFileName(t,i,n.length,o++,!0);e.push({url:s.url,originalName:s.name,encodedName:a})}}returne}}classs{constructor(e,t){this.fileObj=e,this.utils=t}getEncodedName(){returnthis.utils.encodeFileName(this.fileObj.name)}getEncodedExtension(){returnthis.utils.encodeFileName(this.fileObj.extension)}getOriginalName(){returnthis.fileObj.name}getOriginalExtension(){returnthis.fileObj.extension}getUrl(){returnthis.fileObj.url}equals(e){return"object"==typeofe&&e.name===this.fileObj.name&&e.url===this.fileObj.url}}classi{constructor(e){this.bootCSS={href:"https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css",integrity:"sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1"},this.bootJS={src:"https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js",integrity:"sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"},this.vueJS={src:"https://unpkg.com/vue@3.2.28/dist/vue.global.js"},this.utils=e}asynccreateDownloadUI(e){document.head.innerHTML="",document.body.innerHTML="",document.getElementsByTagName("html")[0].style.height="100%",document.body.style.height="100%",document.body.style.margin="0",document.title=e;lett=document.createElement("link");t.href=this.bootCSS.href,t.rel="stylesheet",t.integrity=this.bootCSS.integrity,t.crossOrigin="anonymous",document.head.appendChild(t);letn=document.createElement("div");n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.flexDirection="column",n.style.height="100%";leto=document.createElement("div");o.className="input-groupmb-2",o.style.width="400px";lets=document.createElement("input");s.type="text",s.className="form-control",s.placeholder="ここにJSONを貼り付け",o.appendChild(s);leti=document.createElement("div");i.className="input-group-append";leta=document.createElement("button");a.className="btnbtn-outline-secondarybtn-labeled",a.type="button",a.innerText="Download",i.appendChild(a),o.appendChild(i),n.appendChild(o);letr=document.createElement("div");r.className="progressmb-3",r.style.width="400px";letl=document.createElement("div");l.className="progress-bar",l.role="progressbar",l["aria-valuemin"]="0",l["aria-valuemax"]="100",l["aria-valuenow"]="0",l.style.width="0%",l.innerText="0%";constc=e=>{l["aria-valuenow"]=`${e}`,l.style.width=`${e}%`,l.innerText=`${e}%`};r.appendChild(l),n.appendChild(r);letd=document.createElement("div");d.style.width="350px";letu=document.createElement("div");u.className="form-checkfloat-start";leth=document.createElement("input");h.className="form-check-input",h.type="checkbox",h.id="LogCheck",h.checked=!0,u.appendChild(h);letp=document.createElement("label");p.className="form-check-label",p.for="LogCheck",p.innerText="ログを自動スクロール",u.appendChild(p),d.appendChild(u);letm=document.createElement("div");m.className="float-end",m.innerText="残りおよそ-:--";constg=e=>m.innerText=`残りおよそ${e}`;d.appendChild(m),n.appendChild(d);letf=document.createElement("textarea");f.className="form-control",f.readOnly=!0,f.style.resize="both",f.style.width="500px",f.style.height="80px";constb=e=>{f.value+=`${e}\n`,h.checked&&(f.scrollTop=f.scrollHeight)};n.appendChild(f),document.body.appendChild(n);letv=document.createElement("script");v.src=this.bootJS.src,v.integrity=this.bootJS.integrity,v.crossOrigin="anonymous",document.body.appendChild(v);consty=this.downloadZip.bind(this);a.onclick=async()=>{a.disabled=!0;conste=e=>e.returnValue="downloading";window.addEventListener("beforeunload",e);try{awaity(JSON.parse(s.value),c,b,g)}catch(e){b("エラー出た"),console.error(e)}finally{window.removeEventListener("beforeunload",e)}}}asyncdownloadZip(e,t,n,o){if(!this.isDownloadJsonObj(e))thrownewError("ダウンロード対象オブジェクトの型が不正");consts=this,i=this.utils;awaiti.embedScript("https://cdn.jsdelivr.net/npm/web-streams-polyfill@2.0.2/dist/ponyfill.min.js"),awaiti.embedScript("https://cdn.jsdelivr.net/npm/streamsaver@2.0.6/StreamSaver.js"),awaiti.embedScript("https://cdn.jsdelivr.net/npm/streamsaver@2.0.6/examples/zip-stream.js");consta=i.encodeFileName(e.id),r=streamSaver.createWriteStream(`${a}.zip`),l=newcreateWriter({asyncpull(r){constl=Math.floor(Date.now()/1e3);letc=0;constd=(e,t)=>r.enqueue(newFile(e,`${a}/${t}`));n(`@${e.id}投稿:${e.postCount}ファイル:${e.fileCount}`),d([s.createRootHtmlFromPosts(e)],"index.html");letu=0;for(constaofe.posts){n(`${a.originalName}(${++u}/${e.postCount})`);constr=i.createInformationFile(a.informationText);if(d(r.content,`${a.encodedName}/${i.encodeFileName(r.name)}`),d([s.createHtmlFromBody(a.originalName,a.htmlText)],`${a.encodedName}/index.html`),a.cover){n(`download${a.cover.name}`);conste=awaiti.fetchWithLimit(a.cover,1);e&&d([e],`${a.encodedName}/${a.cover.name}`)}leth=0;for(constsofa.files){n(`download${s.encodedName}(${++h}/${a.files.length})`);constr=awaiti.fetchWithLimit({url:s.url,name:s.encodedName},1);r?d([r],`${a.encodedName}/${s.encodedName}`):(console.error(`${s.encodedName}(${s.url})のダウンロードに失敗、読み飛ばすよ`),n(`${s.encodedName}のダウンロードに失敗`)),c++,setTimeout((()=>{constn=Math.floor(Math.abs(Math.floor(Date.now()/1e3)-l)*(e.fileCount-c)/c),s=n/3600|0,i=Math.ceil((n-3600*s)/60);o(`${s}:${("00"+i).slice(-2)}`),t(100*c/e.fileCount|0)}),0),awaiti.sleep(100)}}r.close()}});if(window.WritableStream&&l.pipeTo)returnl.pipeTo(r).then((()=>console.log("donewriting")));constc=r.getWriter(),d=l.getReader(),u=()=>d.read().then((e=>e.done?c.close():c.write(e.value).then(u)));awaitu()}isDownloadJsonObj(e){switch(!0){case"object"!=typeofe:returnconsole.error("ダウンロード用オブジェクトの型が不正(対象がobjectでない)",e),!1;case"number"!=typeofe.postCount:returnconsole.error("ダウンロード用オブジェクトの型が不正(postCountが数値でない)",e.postCount),!1;case"number"!=typeofe.fileCount:returnconsole.error("ダウンロード用オブジェクトの型が不正(fileCountが数値でない)",e.fileCount),!1;case"string"!=typeofe.id:returnconsole.error("ダウンロード用オブジェクトの型が不正(idが文字列でない)",e.id),!1;case"string"!=typeofe.url:returnconsole.error("ダウンロード用オブジェクトの型が不正(urlが文字列でない)",e.url),!1;case!Array.isArray(e.posts):returnconsole.error("ダウンロード用オブジェクトの型が不正(postsが配列でない)",e.posts),!1;case!Array.isArray(e.tags):returnconsole.error("ダウンロード用オブジェクトの型が不正(tagsが配列でない)",e.tags),!1}return!e.posts.some((t=>{switch(!0){case"object"!=typeoft:returnconsole.error("ダウンロード用オブジェクトの型が不正(postsの値にobjectでないものが含まれる)",t,e.posts),!0;case"string"!=typeoft.informationText:returnconsole.error("ダウンロード用オブジェクトの型が不正(postsの値にinformationTextが文字列でないものが含まれる)",t.informationText,e.posts),!0;case"string"!=typeoft.htmlText:returnconsole.error("ダウンロード用オブジェクトの型が不正(postsの値にhtmlTextが文字列でないものが含まれる)",t.htmlText,e.posts),!0;case!Array.isArray(t.files):returnconsole.error("ダウンロード用オブジェクトの型が不正(postsの値にfilesが配列でないものが含まれる)",t.files,e.posts),!0;case!Array.isArray(t.tags):returnconsole.error("ダウンロード用オブジェクトの型が不正(postsの値にtagsが配列でないものが含まれる)",t.tags,e.posts),!0;caset.files.some((n=>{varo,s,i,a;switch(!0){case"object"!=typeofn:returnconsole.error("ダウンロード用オブジェクトの型が不正(postsのfilesの値にオブジェクトでないものが含まれる)",n,t.files),!0;case"string"!=typeofn.url:returnconsole.error("ダウンロード用オブジェクトの型が不正(postsのfilesの値にurlが文字列でないものが含まれる)",n.url,t.files),!0;case"string"!=typeofn.originalName:returnconsole.error("ダウンロード用オブジェクトの型が不正(postsのfilesの値にoriginalNameが文字列でないものが含まれる)",n.originalName,t.files),!0;case"string"!=typeofn.encodedName:returnconsole.error("ダウンロード用オブジェクトの型が不正(postsのfilesの値にencodedNameが文字列でないものが含まれる)",n.encodedName,t.files),!0;casevoid0===t.cover:return!1;case"object"!=typeoft.cover:returnconsole.error("ダウンロード用オブジェクトの型が不正(postsの値にcoverがobjectでないものが含まれる)",t.cover,e.posts),!0;case"string"!=typeof(null===(o=t.cover)||void0===o?void0:o.url):returnconsole.error("ダウンロード用オブジェクトの型が不正(postsのcoverの値にurlが文字列でないものが含まれる)",null===(s=t.cover)||void0===s?void0:s.url,t.cover),!0;case"string"!=typeof(null===(i=t.cover)||void0===i?void0:i.name):returnconsole.error("ダウンロード用オブジェクトの型が不正(postsのcoverの値にnameが文字列でないものが含まれる)",null===(a=t.cover)||void0===a?void0:a.name,t.cover),!0;default:return!1}})):return!0;default:return!1}}))}createRootHtmlFromPosts(e){return`<!DOCTYPEhtml>\n<htmllang="ja">\n<head>\n<metacharset="utf-8"/>\n<title>${e.id}</title>\n<linkhref="${this.bootCSS.href}"rel="stylesheet"integrity="${this.bootCSS.integrity}"crossOrigin="anonymous">\n<style>div.main{width:600px;float:none;margin:65pxauto0}div.root{width:400px}div.post{width:600px}a.hl,a.hl:hover{color:inherit;text-decoration:none;}div.card{float:none;margin:0auto;}img.gray-card{height:210px;background-color:gray;}div.gray-carousel{height:210px;width:400px;background-color:gray;}img.pd-carousel{height:210px;padding:15px;}</style>\n</head>\n<body>\n<divclass="main"id="main">\n<navclass="navbarnavbar-expand-lgnavbar-darkbg-darkfixed-top"><divclass="container-fluid">\n<aclass="navbar-brand"href="${e.url}">${e.id}</a>\n<buttonclass="navbar-toggler"type="button"data-bs-toggle="collapse"data-bs-target="#dd"aria-controls="dd"aria-expanded="false"aria-label="Togglenavigation">\n<spanclass="navbar-toggler-icon"></span>\n</button>\n<divclass="collapsenavbar-collapse"id="dd"><ulclass="navbar-nav">\n<liclass="nav-itemdropdown">\n<aclass="nav-linkdropdown-toggle"href="#"id="navbarDarkDropdownMenuLink"role="button"data-bs-toggle="dropdown"aria-expanded="false">Tags</a>\n<ulclass="dropdown-menudropdown-menu-dark"aria-labelledby="dd">\n<liv-for="(tag,i)in[${e.tags.map((e=>this.utils.toQuoted(e))).join(",")}]">\n<divclass="form-checkmx-1">\n<inputclass="form-check-input"type="checkbox"v-model="selected":value="tag":id="'box'+(i+1)">\n<labelclass="form-check-label":for="'box'+(i+1)">{{tag}}</label>\n</div>\n</li>\n</ul>\n</li>\n</ul></div>\n</div></nav>\n\n`+e.posts.map((e=>`<divv-show="isVisible([${e.tags.map((e=>this.utils.toQuoted(e))).join(",")}],selected)">\n<aclass="hl"href="./${this.utils.encodeURI(e.encodedName)}/index.html"><divclass="rootcard">\n`+this.createCoverHtmlFromPost(e)+`<divclass="card-body"><h5class="card-title">${e.originalName}</h5></div>\n</div></a><br>\n</div>\n`)).join("\n")+`\n</div>\n<scriptsrc="${this.vueJS.src}"><\/script>\n<script>\nVue.createApp({\ndata(){return{selected:[]}},methods:{\nisVisible(tags,selected){\nif(!selected.length)returntrue\nreturnselected.every(it=>tags.includes(it))\n}\n}\n}).mount('#main')\n<\/script>\n<scriptsrc="${this.bootJS.src}"integrity="${this.bootJS.integrity}"crossOrigin="anonymous"><\/script>\n</body></html>`}createCoverHtmlFromPost(e){constt=`./${this.utils.encodeURI(e.encodedName)}/`;if(e.cover)return`<imgclass="card-img-topgray-card"src="${t}${this.utils.encodeURI(e.cover.name)}"alt="カバー画像"/>\n`;constn=e.files.filter((e=>this.utils.isImage(e.encodedName)));returnn.length>0?'<divclass="carouselslide"data-bs-ride="carousel"data-interval="1000"><divclass="carousel-inner">\n<divclass="carousel-itemactive">'+n.map((e=>`<divclass="d-flexjustify-content-centergray-carousel"><imgsrc="${t}${this.utils.encodeURI(e.encodedName)}"class="d-blockpd-carousel"height="180px"/></div>`)).join('</div>\n<divclass="carousel-item">')+"</div>\n</div></div>\n":'<imgclass="card-img-topgray-card"/>\n'}createHtmlFromBody(e,t){return`<!DOCTYPEhtml>\n<htmllang="ja">\n<head>\n<metacharset="utf-8"/>\n<title>${e}</title>\n<linkhref="${this.bootCSS.href}"rel="stylesheet"integrity="${this.bootCSS.integrity}"crossOrigin="anonymous">\n<style>div.main{width:600px;float:none;margin:0auto}div.root{width:400px}div.post{width:600px}a.hl,a.hl:hover{color:inherit;text-decoration:none;}div.card{float:none;margin:0auto;}img.gray-card{height:210px;background-color:gray;}div.gray-carousel{height:210px;width:400px;background-color:gray;}img.pd-carousel{height:210px;padding:15px;}</style>\n</head>\n<body>\n<divclass="main">\n${t}\n</div>\n<scriptsrc="${this.bootJS.src}"integrity="${this.bootJS.integrity}"crossOrigin="anonymous"><\/script>\n</body></html>`}}classa{constructor(e,t){this.userId=e,this.feeMap=t,this.isIgnoreFree=!1,this.fees=[],this.tags=[],this.isLimitAvailable=!1,this.limit=0,this.downloadObject=newn(e,a.utils)}addFee(e){this.fees=[...newSet([...this.fees,e])]}addTags(...e){this.tags=[...newSet([...this.tags,...e])]}applyTags(){conste=this.fees.sort(((e,t)=>e-t)).map((e=>this.getTagByFee(e))),t=this.tags.filter((t=>!e.includes(t)));this.downloadObject.setTags([...e,...t])}getTagByFee(e){vart;returnnull!==(t=this.feeMap.get(e))&&void0!==t?t:(e>0?`${e}円`:"無料")+"プラン"}setLimitAvailable(e){this.isLimitAvailable=e}isLimitValid(){return!this.isLimitAvailable||this.limit>0}decrementLimit(){this.isLimitAvailable&&this.limit--}setLimit(e){this.isLimitAvailable&&(this.limit=e)}}asyncfunctionr(){vare,t,n,o;lets;if("https://downloads.fanbox.cc"===window.location.origin)returnvoidawaitnewi(a.utils).createDownloadUI("fanbox-downloader");if("https://www.fanbox.cc"===window.location.origin){constn=null===(e=window.location.href.match(/fanbox.cc\/@([^\/]*)/))||void0===e?void0:e[1],o=null===(t=window.location.href.match(/fanbox.cc\/@.*\/posts\/(\d*)/))||void0===t?void0:t[1];s=awaitl(n,o)}else{if(!window.location.href.match(/^https:\/\/(.*)\.fanbox\.cc\//))returnvoidalert(`ここどこですか(${window.location.href})`);{conste=null===(n=window.location.href.match(/^https:\/\/(.*)\.fanbox\.cc\//))||void0===n?void0:n[1],t=null===(o=window.location.href.match(/.*\.fanbox\.cc\/posts\/(\d*)/))||void0===o?void0:o[1];s=awaitl(e,t)}}if(!s)return;constr=s.stringify();console.log(r);constc=()=>{alert("jsonをコピーしました。downloads.fanbox.ccで実行して貼り付けてね"),confirm("downloads.fanbox.ccに遷移する？")&&(document.location.href="https://downloads.fanbox.cc")};try{awaitnavigator.clipboard.writeText(r),c()}catch(e){document.body.addEventListener("click",(()=>{navigator.clipboard.writeText(r).then((()=>c())).catch((()=>alert("jsonコピーに失敗しました。もう一度実行するかコンソールからコピーしてね")))}),{once:!0}),alert("jsonコピーに失敗しました。画面の適当なとこをクリック！")}}asyncfunctionl(e,t){varn,o;if(!e)returnvoidalert("しらないURL");consts=a.utils.httpGetAs(`https://api.fanbox.cc/plan.listCreator?creatorId=${e}`).body,i=newMap;null==s||s.forEach((e=>i.set(e.fee,e.title)));constr=newa(e,i);r.downloadObject.setUrl(`https://www.fanbox.cc/@${e}`);constl=null!==(o=null===(n=a.utils.httpGetAs(`https://api.fanbox.cc/tag.getFeatured?creatorId=${e}`).body)||void0===n?void0:n.map((e=>e.tag)))&&void0!==o?o:[];returnr.addTags(...l),t?u(r,d(t)):awaitasyncfunction(e){e.isIgnoreFree=confirm("無料コンテンツを省く？");constt=prompt("取得制限数を入力キャンセルで全て取得");if(t){constn=Number.parseInt(t);n&&(e.setLimitAvailable(!0),e.setLimit(n))}letn=`https://api.fanbox.cc/post.listCreator?creatorId=${e.userId}&limit=100`;for(lett=1;n;t++)console.log(`${t}回目`),n=awaitc(e,n),awaita.utils.sleep(10)}(r),r.applyTags(),r.downloadObject}asyncfunctionc(e,t){constn=a.utils.httpGetAs(t);console.log(`投稿の数:${n.body.items.length}`);for(consttofn.body.items){if(!e.isLimitValid())break;t.body?u(e,t):t.isRestricted||(awaita.utils.sleep(10),u(e,d(t.id)))}returnn.body.nextUrl}functiond(e){returna.utils.httpGetAs(`https://api.fanbox.cc/post.info?postId=${e}`).body}functionu(e,t){if(!t||e.isIgnoreFree&&0===t.feeRequired)return;if(!t.body||t.isRestricted)returnvoidconsole.log(`取得できませんでした(支援がたりない？)\nfeeRequired:${t.feeRequired}@${t.id}`);constn=t.title,o=e.downloadObject.addPost(n);o.setTags([e.getTagByFee(t.feeRequired),...t.tags]),e.addFee(t.feeRequired),e.addTags(...t.tags);consts=(e=>{vart;if(e){consts=null!==(t=e.split(".").pop())&&void0!==t?t:"";return`${o.getImageLinkTag(o.setCover("cover",s,e))}<h5>${n}</h5>\n`}return`<h5>${n}</h5>\n<br>\n`})(t.coverImageUrl);leti;switch(t.type){case"image":{conste=t.body.images.map((e=>o.addFile(n,e.extension,e.originalUrl))).map((e=>o.getImageLinkTag(e))).join("<br>\n"),a=t.body.text.split("\n").map((e=>`<span>${e}</span>`)).join("<br>\n");o.setHtml(s+e+"<br>\n"+a),i=`${t.body.text}\n`;break}case"file":{conste=t.body.files.map((e=>o.addFile(e.name,e.extension,e.url))).map((e=>o.getAutoAssignedLinkTag(e))).join("<br>\n"),n=t.body.text.split("\n").map((e=>`<span>${e}</span>`)).join("<br>\n");o.setHtml(s+e+"<br>\n"+n),i=`${t.body.text}\n`;break}case"article":{conste=function(e,t){constn=t.filter((e=>"image"===e.type)).map((e=>e.imageId)),o=e=>{vart;returnnull!==(t=n.indexOf(e))&&void0!==t?t:n.length};returnObject.keys(e).sort(((e,t)=>o(e)-o(t))).map((t=>e[t]))}(t.body.imageMap,t.body.blocks).map((e=>o.addFile(n,e.extension,e.originalUrl))),a=function(e,t){constn=t.filter((e=>"file"===e.type)).map((e=>e.fileId)),o=e=>{vart;returnnull!==(t=n.indexOf(e))&&void0!==t?t:n.length};returnObject.keys(e).sort(((e,t)=>o(e)-o(t))).map((t=>e[t]))}(t.body.fileMap,t.body.blocks).map((e=>o.addFile(e.name,e.extension,e.url))),r=function(e,t){constn=t.filter((e=>"embed"===e.type)).map((e=>e.embedId)),o=e=>{vart;returnnull!==(t=n.indexOf(e))&&void0!==t?t:n.length};returnObject.keys(e).sort(((e,t)=>o(e)-o(t))).map((t=>e[t]))}(t.body.embedMap,t.body.blocks),l=function(e,t){constn=t.filter((e=>"url_embed"===e.type)).map((e=>e.urlEmbedId)),o=e=>{vart;returnnull!==(t=n.indexOf(e))&&void0!==t?t:n.length};returnObject.keys(e).sort(((e,t)=>o(e)-o(t))).map((t=>e[t]))}(t.body.urlEmbedMap,t.body.blocks);letc=0,d=0,u=0,h=0;constp=t.body.blocks.map((t=>{varn;switch(t.type){case"p":return`<span>${t.text}</span>`;case"header":return`<h2><span>${t.text}</span></h2>`;case"file":returno.getAutoAssignedLinkTag(a[d++]);case"image":returno.getImageLinkTag(e[c++]);case"embed":return`<span>${JSON.stringify(r[u++])}</span>`;case"url_embed":{conste=l[h++];switch(e.type){case"default":returno.getLinkTag(e.url,e.host);case"html":case"html.card":constt=null===(n=e.html.match(/<iframe.*src="(http.*)"/))||void0===n?void0:n[1];returnt?o.getLinkTag(t,"iframelink"):`\n${e.html}\n\n`;case"fanbox.post":consts=`https://www.fanbox.cc/@${e.postInfo.creatorId}/posts/${e.postInfo.id}`;returno.getLinkTag(s,e.postInfo.title);default:return`<span>${JSON.stringify(e)}</span>`}}default:returnconsole.error(`unknownblocktype:${t.type}`)}})).join("<br>\n");o.setHtml(s+p),i=t.body.blocks.filter((e=>"p"===e.type||"header"===e.type)).map((e=>e.text)).join("\n")+"\n";break}case"text":{conste=t.body.text.split("\n").map((e=>`<span>${e}</span>`)).join("<br>\n");i=t.body.text,o.setHtml(s+e);break}default:i=`不明なタイプ\n${t.type}@${t.id}\n`,console.log(`不明なタイプ\n${t.type}@${t.id}`)}constr={postId:t.id,title:t.title,creatorId:t.creatorId,fee:t.feeRequired,publishedDatetime:t.publishedDatetime,updatedDatetime:t.updatedDatetime,tags:t.tags,likeCount:t.likeCount,commentCount:t.commentCount};if(a.isExportJson)o.setInfo(JSON.stringify(Object.assign(Object.assign({},r),{parsedText:i})));else{conste=Object.keys(r).map((e=>`${e}:${JSON.stringify(r[e])}`)).join("\n");o.setInfo(e+"\nparsedText:\n"+i)}e.decrementLimit()}a.utils=newclass{constructor(){this.audioExtension=/\.(mp3|m4a|ogg)$/,this.imageExtension=/\.(apng|avif|gif|jpg|jpeg|jfif|pjpeg|pjp|png|svg|webp)$/,this.videoExtension=/\.(mp4|webm|ogv)$/}isAudio(e){returnnull!=e.match(this.audioExtension)}isImage(e){returnnull!=e.match(this.imageExtension)}isVideo(e){returnnull!=e.match(this.videoExtension)}httpGetAs(e){constt=newXMLHttpRequest;returnt.open("GET",e,!1),t.withCredentials=!0,t.send(null),JSON.parse(t.responseText)}encodeFileName(e){returne.replace(/\//g,"／").replace(/\\/g,"＼").replace(/,/g,"，").replace(/:/g,"：").replace(/\*/g,"＊").replace(/"/g,"“").replace(/</g,"＜").replace(/>/g,"＞").replace(/\|/g,"｜").trim()}encodeURI(e){returnthis.encodeFileName(e).replaceAll(/[;,/?:@&=+$#]/g,encodeURIComponent)}splitExt(e){returne.split(/(?=\.[^.]+$)/)}getFileName(e,t,n,o,s){returnn<=1?`${e}${t}`:s?`${e}_${o+1}${t}`:`${e}_${n-o}${t}`}toQuoted(e){return`'${e.replaceAll("'","\\'")}'`}createInformationFile(e){try{return{name:"info.json",content:[JSON.stringify(JSON.parse(e),null,"\t")]}}catch(t){return{name:"info.txt",content:[e]}}}asyncsleep(e){returnnewPromise((t=>setTimeout(t,e)))}asyncfetchWithLimit({url:e,name:t},n){if(n<0)returnnull;try{returnawaitfetch(e).catch((e=>{thrownewError(e)})).then((e=>e.ok?e.blob():null))||awaitthis.fetchWithLimit({url:e,name:t},n-1)}catch(o){returnconsole.error(`通信エラー:${t},${e}`),awaitthis.sleep(1e3),awaitthis.fetchWithLimit({url:e,name:t},n-1)}}asyncembedScript(e){returnnewPromise(((t,n)=>{leto=document.createElement("script");o.src=e,o.onload=()=>t(o),o.onerror=e=>n(e),document.head.appendChild(o)}))}},a.isExportJson=!0;varh=t.D;export{hasmain};
